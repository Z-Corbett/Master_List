!function(l){var d=function(){var a={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};function i(t){var e,i;if(Array.isArray(t)||(e=t)&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e))try{return i=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var s,l="boolean"==typeof e.cycles&&e.cycles,d=e.cmp&&(s=e.cmp,function(o){return function(t,e){var i={key:t,value:o[t]},n={key:e,value:o[e]};return s(i,n)}}),c=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var i,n;if(Array.isArray(e)){for(n="[",i=0;i<e.length;i++)i&&(n+=","),n+=t(e[i])||"null";return n+"]"}if(null===e)return"null";if(-1!==c.indexOf(e)){if(l)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=c.push(e)-1,s=Object.keys(e).sort(d&&d(e));for(n="",i=0;i<s.length;i++){var r=s[i],a=t(e[r]);a&&(n&&(n+=","),n+=JSON.stringify(r)+":"+a)}return c.splice(o,1),"{"+n+"}"}}(t)}(t),a.codec.hex.fromBits(a.hash.sha256.hash(i))}catch(t){}}function t(t,e){return!(!e&&"string"==typeof e)&&i(t)===e}if(a.bitArray={bitSlice:function(t,e,i){return t=a.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===i?t:a.bitArray.clamp(t,i-e)},extract:function(t,e,i){var n=Math.floor(-e-i&31);return(-32&(e+i-1^e)?t[e/32|0]<<32-n^t[e/32+1|0]>>>n:t[e/32|0]>>>n)&(1<<i)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var i=t[t.length-1],n=a.bitArray.getPartial(i);return 32===n?t.concat(e):a.bitArray._shiftRight(e,n,0|i,t.slice(0,t.length-1))},bitLength:function(t){var e,i=t.length;return 0===i?0:(e=t[i-1],32*(i-1)+a.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;var i=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,0<i&&e&&(t[i-1]=a.bitArray.partial(e,t[i-1]&2147483648>>e-1,1)),t},partial:function(t,e,i){return 32===t?e:(i?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(a.bitArray.bitLength(t)!==a.bitArray.bitLength(e))return!1;var i,n=0;for(i=0;i<t.length;i++)n|=t[i]^e[i];return 0===n},_shiftRight:function(t,e,i,n){var o,s,r;for(void 0===n&&(n=[]);32<=e;e-=32)n.push(i),i=0;if(0===e)return n.concat(t);for(o=0;o<t.length;o++)n.push(i|t[o]>>>e),i=t[o]<<32-e;return s=t.length?t[t.length-1]:0,r=a.bitArray.getPartial(s),n.push(a.bitArray.partial(e+r&31,32<e+r?i:n.pop(),1)),n},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,i;for(e=0;e<t.length;++e)i=t[e],t[e]=i>>>24|i>>>8&65280|(65280&i)<<8|i<<24;return t}},a.codec.utf8String={fromBits:function(t){var e,i,n="",o=a.bitArray.bitLength(t);for(e=0;e<o/8;e++)0==(3&e)&&(i=t[e/4]),n+=String.fromCharCode(i>>>8>>>8>>>8),i<<=8;return decodeURIComponent(escape(n))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,i=[],n=0;for(e=0;e<t.length;e++)n=n<<8|t.charCodeAt(e),3==(3&e)&&(i.push(n),n=0);return 3&e&&i.push(a.bitArray.partial(8*(3&e),n)),i}},a.codec.hex={fromBits:function(t){var e,i="";for(e=0;e<t.length;e++)i+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return i.substr(0,a.bitArray.bitLength(t)/4)},toBits:function(t){var e,i,n=[];for(i=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)n.push(0^parseInt(t.substr(e,8),16));return a.bitArray.clamp(n,4*i)}},a.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},a.hash.sha256.hash=function(t){return(new a.hash.sha256).update(t).finalize()},a.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=a.codec.utf8String.toBits(t));var e,i=this._buffer=a.bitArray.concat(this._buffer,t),n=this._length,o=this._length=n+a.bitArray.bitLength(t);if(9007199254740991<o)throw new a.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var s=new Uint32Array(i),r=0;for(e=512+n-(512+n&511);e<=o;e+=512)this._block(s.subarray(16*r,16*(r+1))),r+=1;i.splice(0,16*r)}else for(e=512+n-(512+n&511);e<=o;e+=512)this._block(i.splice(0,16));return this},finalize:function(){var t,e=this._buffer,i=this._h;for(t=(e=a.bitArray.concat(e,[a.bitArray.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),i},_init:[],_key:[],_precompute:function(){var t,e,i=0,n=2;function o(t){return 4294967296*(t-Math.floor(t))|0}for(;i<64;n++){for(e=!0,t=2;t*t<=n;t++)if(n%t==0){e=!1;break}e&&(i<8&&(this._init[i]=o(Math.pow(n,.5))),this._key[i]=o(Math.pow(n,1/3)),i++)}},_block:function(t){var e,i,n,o,s=this._h,r=this._key,a=s[0],l=s[1],d=s[2],c=s[3],h=s[4],u=s[5],f=s[6],p=s[7];for(e=0;e<64;e++)i=(i=e<16?t[e]:(n=t[e+1&15],o=t[e+14&15],t[15&e]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+t[15&e]+t[e+9&15]|0))+p+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(f^h&(u^f))+r[e],p=f,f=u,u=h,h=c+i|0,c=d,d=l,a=i+((l=a)&d^c&(l^d))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;s[0]=s[0]+a|0,s[1]=s[1]+l|0,s[2]=s[2]+d|0,s[3]=s[3]+c|0,s[4]=s[4]+h|0,s[5]=s[5]+u|0,s[6]=s[6]+f|0,s[7]=s[7]+p|0}},"undefined"==typeof module||!module.exports)return{verify:t,generate:i};module.exports.verify=t,module.exports.generate=i}(),c="data-collections",s="data-collections-thumbs",h=null,u=null;function f(t){return null!=t}function p(t,e,i){var n,o=t.attr(i?s:c);if(o){if(n=atob(o),!1===e)return n;try{return JSON.parse(n)}catch(t){console.log("failed to parse "+o+" attribute, ",t)}}}function _(t,n,e){var i,o,s=l.makeArray(arguments).slice(3),r=s.shift(),a=s.shift();return l.isFunction(r)&&!f(a)&&(a=r,r=void 0),h&&u?((i={query:e,layouts:{}}).layouts[n]=null,r&&(i.design=r,i.design.useDeferredLoading&&(i.design.useDeferredLoading=!1),i.design.mosaicColSpans=null),(o=d.generate({siteId:u,type:t,params:i}))?void l.ajax({type:"POST",url:h.replace("{type}",t)+"/"+o,data:JSON.stringify(i),contentType:"application/json",dataType:"json"}).done(function(t){var e,i=!1;t&&(e=t[n])&&t.__sys&&(i=!0===t.__sys.additional),a(null,e,i)}).fail(function(t){a(t)}):a(new Error("Failed to generate version"))):a(new Error("Invalid collections API"))}function m(i,t){var n;return t&&(l.isArray(t.tags)&&(l.isArray(i.tags)?(n=i.tags.length?[i.tags]:[],l.each(t.tags,function(t,e){-1===l.inArray(e,i.tags)&&n.push(l.isArray(e)?e:[e])}),i.tags=n):i.tags=t.tags),t.skip&&(i.skip=t.skip)),i}function i(t){if(!t)return console.error("A container must be specified for the pagination block");this._dom={},this._dom.container=t,this._dom.controls=t.find(".paginationControls"),this._dom.progressSpinner=t.find(".progressSpinner"),this._isLoading=!1,this._isAnimating=!1,this._queuedItems=null,this._queuedThumbs=null,this._hasSearch=0<t.find(".collectionSearch").length,this._isManual="true"===t.attr("data-manual"),this._isSlideshow=t.hasClass("hasSlideshow"),this._hasThumbs=t.hasClass("hasThumbs"),this._isCarousel=t.hasClass("hasCarousel"),this._isImgGrid=t.hasClass("hasGridGallery"),this._isImgRows=t.hasClass("hasRowGallery"),this._isImgStack=t.hasClass("hasStackedGallery"),this._dom.itemsContainer=t.find(".itemsCollectionContent").length?t.find(".itemsCollectionContent"):t.find(".galleryWrapper"),this._isResources=t.hasClass("resourcesCollection"),this._isResources&&(this._dom.itemsContainer=t.find(".resources")),this._animationType=t.attr("data-pagination-anim"),this._isSlideshow&&(this._dom.slider=t.find(".flexslider")),this._hasThumbs&&(this._dom.thumbs=t.find(".flexNavigator")),this._isCarousel&&(this._dom.slider=t.find(".carousel"))}i.prototype.setup=function(){this._isSlideshow||this._isCarousel?(this._setupSlideshow(this._dom.slider),this._hasThumbs&&this._setupSlideshow(this._dom.thumbs)):this._hasSearch?this._setupSearch():imagesLoaded(this._dom.container.find("img"),this._setupEndlessScroll.bind(this))},i.prototype._setupSearch=function(){this._dom.form=this._dom.container.find(".collectionSearch-form"),this._dom.input=this._dom.container.find(".collectionSearch-input"),this._dom.form.on("submit",l.proxy(this._submitSearch,this))},i.prototype._submitSearch=function(t){t.preventDefault();var e=this._dom.input.val().trim();e&&(this._searchTerm=e,this._dom.itemsContainer.empty(),this._dom.container.attr("data-pagenum",0),this._addEndlessScrollItems(!0),this._observer||this._isManual||imagesLoaded(this._dom.container.find("img"),this._setupEndlessScroll.bind(this)))},i.prototype._addQueuedSliderItems=function(t,e){this._queuedItems&&0<this._queuedItems.length&&(this._addSlides(this._queuedItems,t),this._queuedItems=null),e&&this._queuedThumbs&&0<this._queuedThumbs.length&&(this._addSlides(this._queuedThumbs,t),this._queuedThumbs=null)},i.prototype._setupSlideshow=function(t){var r=this,e=r._isSlideshow?"scFlexsliderAdded":null,i=r._isSlideshow?"scFlexsliderBefore":"scCarouselBefore",n=r._isSlideshow?"scFlexsliderAfter":"scCarouselNavigatedTo",a=t.hasClass("flexNavigator");t.on(i,function(){r._isAnimating=!0}),r._isSlideshow&&t.on(e,function(t,e){"fade"===e.vars.animation&&e.slides.css({opacity:0,display:"block",zIndex:1}).eq(e.currentSlide).css({zIndex:2}).css({opacity:1})}),t.on(n,function(t,i){var n=r._isSlideshow?i.directionNav:i.$nav;if(r._isAnimating=!1,r._queuedItems&&0<r._queuedItems.length||a&&r._queuedThumbs&&0<r._queuedThumbs.length)r._addQueuedSliderItems(i,a);else if(r._canAddToSlideshow(i)&&(r._isLoading=!0,n.filter(".galleryArrow--next").addClass("loading"),r._getNextPage(a,function(t,e){if(n.filter(".galleryArrow--next").removeClass("loading"),t)return r._isLoading=!1,void console.error(t);e&&0<e.length&&(r._isAnimating?a?r._queuedThumbs=e:r._queuedItems=e:r._addSlides(e,i))}),r._hasThumbs)){var o=a?r._dom.slider.data("flexslider"):r._dom.thumbs.data("flexslider"),s=o.directionNav;s.filter(".galleryArrow--next").addClass("loading"),r._getNextPage(!a,function(t,e){if(s.filter(".galleryArrow--next").removeClass("loading"),t)return r._isLoading=!1,void console.error(t);e&&0<e.length&&(r._isAnimating?a?r._queuedThumbs=e:r._queuedItems=e:r._addSlides(e,o))})}}),a&&t.on("scFlexsliderStart",function(t,e){1===e.pagingCount&&e.trigger(n,[e])})},i.prototype._addSlides=function(t,e){e.addSlide(t),this._dom.itemsContainer.trigger("afterAddItems"),window.scSetupImageShapes(this._dom.itemsContainer),(this._isCarousel||this._isSlideshow&&!1===e.hasClass("flexNavigator"))&&this._updatePageNum(),this._isLoading=!1},i.prototype._canAddToSlideshow=function(t){if(!this._isLoading)return this._isCarousel?t._currentSlide>=t._slideCount-1:this._isSlideshow?t.currentSlide>=t.last-1:void 0},i.prototype._setupEndlessScroll=function(){this._observer=new IntersectionObserver(this._handleIntersection.bind(this),{root:null,rootMargin:"0% 0% 50% 0%",threshold:[0]}),this._observer.observe(this._dom.controls[0])},i.prototype._handleIntersection=function(t){this._isIntersecting=t[0].isIntersecting,this._addEndlessScrollItems()},i.prototype._addEndlessScrollItems=function(t){var i=this;(t||i._isIntersecting&&!i._isLoading)&&(i._isLoading=!0,i._showSpinner(),i._getNextPage(!1,function(e,t){if(i._hideSpinner(),e)return i._isLoading=!1,void console.error(e);t?i._appendPageResults(t,function(t){i._isLoading=!1,e?console.error(t):setTimeout(i._addEndlessScrollItems.bind(i),1500)}):i._isLoading=!1}))},i.prototype._getNextPage=function(t,n){var o=this,e=p(this._dom.container.find("["+(t?s:c)+"]"),!0,t),i=e.params.query;this._hasSearch&&this._searchTerm&&(i.search=this._searchTerm,i.fulltext=!0),m(i,{skip:this._getPageNum()*i.limit}),_(e.type,e.params.layout,i,e.params.design,function(t,e){if(t)return n(t),void o._showPaginationMessage();if(!f(e))return o._hideSpinner(),o._showNoneMessage("There are no more items"),void n();var i=l(e).filter(function(){return f(this.innerText)});o._isResources||o._isCarousel||o._isSlideshow||i.addClass("item--tombstone"),n(null,i)})},i.prototype._appendPageResults=function(t,e){var i=this,n=i._dom.itemsContainer.hasClass("masonryGrid")||i._dom.itemsContainer.hasClass("masonryImgGallery");i._dom.container.removeClass("deferredLoadGallery"),i._isImgRows&&i._dom.itemsContainer.trigger("beforeAddItems"),i._updatePageNum(),n?(t.each(function(t,e){l(e).addClass("packeryItem")}),i._dom.itemsContainer.append(t).packery("appended",t).packery()):i._dom.itemsContainer.append(t),imagesLoaded(t,function(){i._dom.itemsContainer.trigger("afterAddItems"),window.scSetupImageShapes(i._dom.itemsContainer),i._addLoadedClass(t),e&&e()})},i.prototype._addLoadedClass=function(t){if("sequential"===this._animationType)var e=t.toArray(),i=setInterval(function(){0!==e.length?l(e.shift()).addClass("loaded"):clearInterval(i)},100);else t.addClass("loaded")},i.prototype._getPageNum=function(){return this._dom.container.attr("data-pagenum")},i.prototype._updatePageNum=function(){this._dom.container.attr("data-pagenum",Number(this._dom.container.attr("data-pagenum"))+1)},i.prototype._showPaginationMessage=function(){this._dom.controls.find(".paginationError").removeClass("scHidden")},i.prototype._showNoneMessage=function(){this._dom.controls.find(".paginationNoneLeft").removeClass("scHidden")},i.prototype._showSpinner=function(){this._dom.progressSpinner.removeClass("scInvisible")},i.prototype._hideSpinner=function(){this._dom.progressSpinner.addClass("scInvisible")},l.fn.scPaginationBlock=function(){this.each(function(t,e){new i(l(e)).setup()})};function n(t){i.call(this,t),this._isComplete=!1,this._categoryId=this._dom.container.attr("data-category-id")}function o(t){if(!t)return console.error("A container must be specified for the image downloader");this._showingPanel=!1,this._dom={},this._dom.container=t,this._dom.categories=t.find(".pfColl-category"),this._dom.gallery=t.find(".galleryWrapper"),this._dom.trigger=t.find(".imageDownloader-trigger"),this._strings=JSON.parse(unescape(this._dom.container.attr("data-download-strings")))}function r(t){if(!t)return console.error("A container must be specified for the location finder block");this._dom={},this._dom.$container=t,this._dom.$layout=t.find(".locFinder-layout"),this._dom.$countWrap=t.find(".locFinder-countWrap"),this._dom.$count=t.find(".locFinder-count"),this._dom.$list=t.find(".locFinder-list"),this._dom.$toggles=t.find(".locFinder-viewToggle"),this._dom.$form=t.find(".locFinder-searchControls"),this._dom.$searchTerm=t.find(".locFinder-input"),this._dom.$radius=t.find(".locFinder-select"),this._dom.$locate=t.find(".locFinder-geolocate"),this._dom.$mapWrap=t.find(".locFinder-map"),this._iconType=t.attr("data-map-icon")}((n.prototype=Object.create(i.prototype)).constructor=n).prototype.setup=function(){this._dom.container.find("img[data-src]").closest(".imgGridItem").css("visiblity","hidden"),imagesLoaded(this._dom.container.find("img"),this._setupEndlessScroll.bind(this))},n.prototype._addEndlessScrollItems=function(){if(this._isIntersecting&&!this._isLoading&&!this._isComplete&&"true"!==this._dom.container.attr("aria-hidden")){var t=this;this._isLoading=!0;var e=this._dom.container,n=e.find(".packery"),i=e.find("img[data-src]").slice(0,16);i.each(function(t,e){var i=l(e);i.closest(".imgGridItem").addClass("item--tombstone").css("visibility","visible"),i.on("load",function(){n.packery("layout"),i.off("load")}),i.attr("src",i.attr("data-src")),i.removeAttr("data-src")}),i.length?imagesLoaded(e[0],function(){e.find(".item--tombstone").removeClass("item--tombstone"),n.packery("layout"),t._isLoading=!1,t._addEndlessScrollItems()}):(this._isLoading=!1,this._isComplete=!0)}},l.fn.scCategoryPagination=function(){this.each(function(t,e){new n(l(e)).setup()})},l.fn.filterCollection=function(){var t,e,i,n=l.makeArray(arguments),r=n.shift(),a=n.shift();if(l.isFunction(r)&&!f(a)&&(a=r,r=void 0),f(a)){if(!l.isFunction(a))throw new TypeError("Invalid callback function")}else a=l.noop;return f(r)||(r={}),e=r,(t=l.isPlainObject(e)?(l.each(e,function(t,e){if("tags"===t?l.isArray(e)||(i=new TypeError('Invalid filter "tags" value')):"page"===t?l.isNumeric(e)&&0<e||(i=new TypeError('Invalid filter "page" value')):i=new TypeError('Invalid filter "'+t+'"'),i)return!1}),i):new TypeError("Invalid filter"))?a(t):this.each(function(){var t,e,o=l(this),s=o.find("["+c+"]");if(s&&s.length&&(t=p(s)),!(t&&t.type&&t.params))return a(new Error("Invalid collection block"),o);m(e=t.params.query||{},r),_(t.type,t.params.layout,e,t.params.design,function(t,e,i){var n={elem:o,container:s,hasResults:!1,hasAdditional:!1};e?(n.hasResults=!0,n.hasAdditional=!0===i,s.html(e)):s.empty(),a(t,n)})})},o.prototype.setup=function(){var e=this;this._dom.trigger.on("click.scImageDownloader",function(t){t.preventDefault(),e._showingPanel?e._disposePanel():(e._showingPanel=!0,e._buildPanel())})},o.prototype._bindImageHandler=function(){this._dom.gallery.find("[data-asset]").on("click.scImageDownloader",{self:this},function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),l(t.currentTarget).parents(".imgGridItem, .imgRowItem, .fs-item, .carousel-slide, .stackedGallery-item").toggleClass("selectedForDownload"),t.data.self._updateCount()})},o.prototype._selectCurrentCategory=function(){this._dom.categories.filter('[aria-hidden="false"]').find("[data-dl-id]").addClass("selectedForDownload"),this._updateCount()},o.prototype._downloadSelected=function(){var s=this;this._dom.dlSelectionBtn[0].disabled=!0,this._dom.catSelectBtn[0].disabled=!0,this._dom.selectAllBtn[0].disabled=!0,this._selections=[],this._dom.categories.each(function(t,e){var i,n=l(e).find("[data-dl-id]"),o=n.filter(".selectedForDownload");o.length&&(i=o.length===n.length||o.map(function(){return this.getAttribute("data-dl-id")}).get(),s._selections.push({id:e.getAttribute("data-category-id"),images:i}))}),this._getDownloadUrl(this._selections)},o.prototype._downloadAll=function(){var i=this;this._dom.dlSelectionBtn[0].disabled=!0,this._dom.catSelectBtn[0].disabled=!0,this._dom.selectAllBtn[0].disabled=!0,this._selections=[],this._dom.categories.each(function(t,e){i._selections.push({id:e.getAttribute("data-category-id"),images:!0})}),this._getDownloadUrl(this._selections)},o.prototype._panelClickDelegate=function(t){if(!t.target.getAttribute("data-reload")){t.preventDefault();var e=t.data.self,i=l(t.target);i.is(".dlPanel-close")||i.closest(".dlPanel-close").length?e._disposePanel():i.is(".dlPanel-selectCat")?e._selectCurrentCategory():i.is(".dlPanel-all")?e._downloadAll():i.is(".dlPanel-dlSelection")&&e._downloadSelected()}},o.prototype._buildPanel=function(){this._selections=[];var t='<div class="dlPanel pfColl-dlPanel">';t+='<a class="dlPanel-close" href="#"><svg viewBox="0 0 48 48" width="100%" height="100%"><path d="M38 12.83l-2.83-2.83-11.17 11.17-11.17-11.17-2.83 2.83 11.17 11.17-11.17 11.17 2.83 2.83 11.17-11.17 11.17 11.17 2.83-2.83-11.17-11.17z"></path></svg></a>',t+='<h2 class="contentTitle">'+this._strings.download+"</h2>",t+='<p class="dlPanel-intro">'+this._strings.selectInstr+"</p>",t+='<div class="dlPanel-selection">',t+='<p class="dlPanel-countWrap"><span class="dlPanel-count">0</span> '+this._strings.selected+"</p>",t+='<button class="dlPanel-dlSelection" disabled>'+this._strings.selectBtn+"</button>",t+="</div>",t+='<button class="button--linky dlPanel-selectCat">'+this._strings.selectCategory+"</button>",t+='<div><button class="dlPanel-all">'+this._strings.allBtn+"</button></div>",t+="</div>",this._dom.panel=l(t).appendTo("body").on("click.scImageDownloader",{self:this},this._panelClickDelegate),this._dom.panelTitle=this._dom.panel.find(".contentTitle"),this._dom.panelIntro=this._dom.panel.find(".dlPanel-intro"),this._dom.panelSelection=this._dom.panel.find(".dlPanel-selection").hide(),this._dom.count=this._dom.panel.find(".dlPanel-count"),this._dom.dlSelectionBtn=this._dom.panel.find(".dlPanel-dlSelection"),this._dom.catSelectBtn=this._dom.panel.find(".dlPanel-selectCat"),this._dom.selectAllBtn=this._dom.panel.find(".dlPanel-all"),this._bindImageHandler(),l("body").trigger("scSelectionModeEntered")},o.prototype._updateCount=function(){var t=this._dom.gallery.find(".selectedForDownload").length;this._dom.count.html(t),this._dom.panelTitle.html(this._strings.selectTitle),this._dom.dlSelectionBtn[0].disabled=0===t,0===t?(this._dom.panelIntro.show(),this._dom.panelSelection.hide()):(this._dom.panelIntro.hide(),this._dom.panelSelection.show())},o.prototype._getDownloadUrl=function(){this._dom.gallery.find("[data-asset]").off(".scImageDownloader"),l("body").trigger("scSelectionModeExited"),this._dom.panelTitle.text(this._strings.inProgress),this._dom.panel.find("p, button, div").remove(),this._dom.spinner=l('<div class="progressSpinner"></div>').appendTo(this._dom.panel);var t=/^\/preview/,e=document.location.pathname;t.test(e)&&(e=e.replace(t,""));var i=l("body").attr("data-ajax-prefix")+"/download"+e,n=this;this._downloadUrlRequest=l.post({url:i,data:JSON.stringify({categories:n._selections}),contentType:"application/json",dataType:"json",cache:!1,success:l.proxy(n._getDownloadUrlSuccess,n),error:l.proxy(n._getDownloadUrlFailure,n),timeout:1e4})},o.prototype._getDownloadUrlSuccess=function(t,e){var i;this._downloadUrlRequest=null,t.url&&t.categories?(i=Math.random().toString(36).substring(2,15)+"-"+Date.now(),this._dom["iframe_"+i]=l("<iframe>",{name:i}).hide().appendTo(l("body")),this._dom.form=l("<form>",{method:"POST",action:t.url,target:i}).appendTo(this._dom.panel),l("<input>",{type:"hidden",name:"categories",value:JSON.stringify(t.categories)}).appendTo(this._dom.form),this._dom.form.submit(),this._disposePanel()):console.error("download url or category data not defined")},o.prototype._getDownloadUrlFailure=function(t,e){if(this._downloadUrlRequest=null,"abort"!==e){var i=403===t.status?"<p>We're sorry, your login to this page has expired. Please <a href=\""+document.location.href+'" data-reload="true">reload</a> and try again.</p>':null;this._renderError(i)}},o.prototype._renderError=function(t){t||(t="<p>We're sorry, an error occurred. Please try again later or contact the site owner.</p>"),this._dom.spinner.remove(),this._dom.panelTitle.html("Download Error").after(t)},o.prototype._disposePanel=function(){this._downloadUrlRequest&&(this._downloadUrlRequest.abort(),this._downloadUrlRequest=null),this._showingPanel=!1,this._dom.gallery.find("[data-asset]").off(".scImageDownloader"),this._dom.gallery.find(".selectedForDownload").removeClass("selectedForDownload"),this._dom.panel.off(".scImageDownloader").remove(),this._images&&this._images.off(".scImageDownloader"),this._selections=null,l("body").trigger("scSelectionModeExited")},l.fn.scImageDownloader=function(){this.each(function(t,e){new o(l(e)).setup()})},r.prototype._updateCount=function(){var t=this._dom.$list.find("> .locFinder-searchResult").length;this._dom.$count.text(t),this._dom.$countWrap.toggleClass("scInvisible",0===t),this._dom.$toggles.on("click",l.proxy(this._toggleClickHandler,this))},r.prototype.setup=function(){this._updateCount(),this._dom.$form.on("submit",l.proxy(this._submitHandler,this)),this._dom.$locate.on("click",l.proxy(this._locateHandler,this))},r.prototype._toggleClickHandler=function(t){t.preventDefault();var e=t.currentTarget.getAttribute("data-target");this._dom.$layout.attr("data-show",e)},r.prototype._submitHandler=function(t){t.preventDefault()},r.prototype._locateHandler=function(t){t.preventDefault()},l.fn.scLocationFinder=function(){this.each(function(t,e){new r(l(e)).setup()})},l(document).ready(function(){var t;(h=p(l("script["+c+"]"),!1))&&(t=/\/([a-f0-9]{32})\//i.exec(h))&&t.length&&(u=t[1]),0<l(".hasPagination").length&&l(".hasPagination").scPaginationBlock(),0<l(".hasCategoryPagination").length&&l(".hasCategoryPagination").scCategoryPagination(),0<l(".hasImageDownloader").length&&l(".hasImageDownloader").scImageDownloader(),0<l(".locFinder").length&&l(".locFinder").scLocationFinder(),0<l(".blockWrap_proofsheetsCollection").length&&l(".blockWrap_proofsheetsCollection").on("tabChanged",function(t,e,i){i.find(".packery").packery("layout")}),window.collections={search:function(t,e){var i,n,o=l.makeArray(arguments).slice(2),s=o.shift(),r=o.shift();if(l.isFunction(s)&&!f(r)&&(r=s,s=void 0),"function"!=typeof r)throw new TypeError("Invalid callback function");if(!t||"string"!=typeof t)return r(new TypeError("Invalid collection type"));if(!e||"string"!=typeof e)return r(new TypeError("Invalid search query"));if(!h||!u)return r(new TypeError("Invalid collections API"));if(s||(s={}),s.layout){if("string"!=typeof s.layout)return r(new TypeError("Invalid layout"));i=s.layout}else i="search";if(n={sort:!1,asc:!0,search:e},s.limit){if(!("number"==typeof s.limit&&0<s.limit))return r(new TypeError("Invalid limit"));n.limit=s.limit}_(t,i,n,r)}}})}(jQuery);